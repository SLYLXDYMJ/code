# vue spa(单页面) app 逻辑
> 前排提示：最好不要使用 hash 路由模式，手机端很多和 app 相关的操作（分享等）不认识 "#" 号，会造成很多的问题。

## bash

```bash
npm i
npm run serve

-> http://localhost:8080
```

## 启发
> 启发于常用 app 应用和微信小程序，都有共同的特征

1. 启动的第一个页面通常是首页（导航页面）
2. 若启动页不是首页，由于某链接直接跳转到商品页等，通常需要添加特殊按钮，用户点击返回首页
3. 前进时，缓存当前页面，加载新页面
4. 后退时，释放当前页面，回到缓存的旧页面(滚动位置也会保留)
5. 前进和后退有不同的过渡动画(通常为滑动，左 -> 右进入，右 -> 左离开)
6. 若点击物理返回键后退时，正处于 “模态对话框(dialog, alert, picker)等”，不会返回页面，会先将对话框关闭

## 实现问题
1. keep-alive 组件无法实现上述的 “前进刷新后退使用缓存” 逻辑
2. 无法判断进入新页面时，是前进操作还是后退操作，无法执行相应动画
3. 若启动页非首页，如何优雅的判断
4. 如何优雅的判断当前正在处于 “模态对话框” 状态，并阻止返回操作

## 思路
> 找到了能实现路由历史的库，[vue-navigation](https://github.com/zack24q/vue-navigation)

- [x] vue-navigation 轻松实现 “前进刷新，后退使用缓存” 逻辑
- [x] 通过 vue-navigation 钩子判断前进还是后退，实现前进和后退的页面动画效果
- [x] 在 App created 中通过 location.path 判断启动页面是否是首页或其他页面
- [x] 定义标识，在弹框显示和隐藏时改变标识，使用 router.beforeEach 钩子，拦截跳转，隐藏 “模态对话框”

## 解析：用户使用物理返回时，若当前显示 “模态对话框”，隐藏对话框，阻止页面跳转
> 详看 /src/plugins/message-box.js

> 此方法在启动页面（第一个路由时无效，因为监听不到，使用 window 关闭事件也不行）

> 若想优雅使用改功能，弹框组件有几个条件：

1. 所有的弹框最好使用全局函数式调用，不局限于组件
2. 弹框内容可以自定义 HTML 内容，保证灵活性
3. 能轻易的关闭所有弹框，保证代码简洁

我找了目前比较流行的 ui 库(vant-ui, cube-ui等)

相关的 popup 组件都无法满足需求

最后只找到 element-ui 能满足所有需求，本例子也是使用了 element-ui 实现

当前不局限于该库，其他符合条件的库均可

若无符合的库一定不要 “硬实现”！

## element-ui 满足点
1. MessageBox 组件可以函数调用
2. MessageBox 组件支持自定义 组件/html
3. MessageBox.close 方法可关闭所有的实例

## element-ui 问题
1. MessageBox this.$msgbox 必须有 title 才能显示右上角关闭按钮